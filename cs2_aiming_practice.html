<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aiming Practice</title>
    <style>
        body {
            display: flex;
            justify-content: center;
            background: url('wallpaper.png') no-repeat center center fixed;
            background-size: cover;
            margin: 0;
        }
        #container {
            width: 1200px;
            padding: 20px;
            background-color: rgba(255, 255, 255, 0.9);  // Poloprùhledné pozadí pro lepší èitelnost
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            margin-top: 20px;
            border-radius: 10px;
        }
        #gameArea {
            position: relative;
            border: 1px solid black;
            margin-top: 20px;
        }
        #circle {
            position: absolute;
            border-radius: 50%;
        }
        .crosshair {
            cursor: crosshair;
        }
        #history {
            margin-top: 20px;
        }
        h1, h2, p, label, button, select, input {
            font-family: Arial, sans-serif;
        }
        h1 {
            text-align: center;
        }
        form {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
        }
        form > div {
            margin-bottom: 10px;
            flex: 1 1 45%;
        }
        label {
            display: block;
            margin-bottom: 5px;
        }
        input, select {
            width: calc(100% - 10px);
            padding: 5px;
            font-size: 14px;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box;
        }
        button {
            background-color: #007bff;
            color: white;
            padding: 10px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            margin-top: 10px;
        }
        button:hover {
            background-color: #0056b3;
        }
    </style>
</head>
<body>
    <div id="container">
        <h1>Aiming Practice</h1>
        <form>
            <div>
                <label for="width">Width of the area (pixels):</label>
                <input type="number" id="width" value="600">
            </div>
            <div>
                <label for="height">Height of the area (pixels):</label>
                <input type="number" id="height" value="400">
            </div>
            <div>
                <label for="circleSize">Size of the circle (pixels):</label>
                <input type="number" id="circleSize" value="50">
            </div>
            <div>
                <label for="speed">Speed of the circle (pixels/second):</label>
                <input type="number" id="speed" value="100">
            </div>
            <div>
                <label for="duration">Duration of the game (seconds):</label>
                <input type="number" id="duration" value="30">
            </div>
            <div>
                <label for="movementType">Movement Type:</label>
                <select id="movementType">
                    <option value="smooth">Smooth</option>
                    <option value="jump">Jump</option>
                </select>
            </div>
            <div>
                <label for="aimingType">Aiming Type:</label>
                <select id="aimingType">
                    <option value="hold">Hold</option>
                    <option value="click">Click</option>
                </select>
            </div>
            <div>
                <label for="circleColor">Circle color:</label>
                <select id="circleColor">
                    <option value="red">Red</option>
                    <option value="black">Black</option>
                </select>
            </div>
            <div style="flex: 1 1 100%; text-align: center;">
                <button type="button" onclick="startGame()">START</button>
            </div>
        </form>

        <div id="gameArea"></div>
        <p>Current Time: <span id="currentTime">0 s / 0 s</span></p>
        <p>Current Score: <span id="currentScore">0</span>%</p>
        <p>Final Score: <span id="finalScore">0</span>%</p>
        <div id="history">
            <h2>Game History</h2>
            <div id="historyList"></div>
            <button onclick="clearHistory()">Clear History</button>
        </div>
    </div>
</body>
</html>
    
   <script>
        let gameArea, circle, startTime, duration, score, totalTime, circleSize, speed, width, height;
        let circlePosX, circlePosY, directionX, directionY, lastTime, gameEnded;
        let isMouseOverCircle = false;
        let movementType, aimingType;
        let timeInterval;

        function startGame() {
            width = document.getElementById('width').value;
            height = document.getElementById('height').value;
            circleSize = document.getElementById('circleSize').value;
            speed = document.getElementById('speed').value;
            duration = document.getElementById('duration').value;
            movementType = document.getElementById('movementType').value;
            aimingType = document.getElementById('aimingType').value;
            let circleColor = document.getElementById('circleColor').value;

            gameArea = document.getElementById('gameArea');
            gameArea.style.width = width + 'px';
            gameArea.style.height = height + 'px';

            // Reset scores and clear any existing circle
            document.getElementById('currentScore').innerText = '0';
            document.getElementById('finalScore').innerText = '0';
            document.getElementById('currentTime').innerText = '0 s / ' + duration + ' s';
            if (circle) {
                gameArea.removeChild(circle);
            }

            circle = document.createElement('div');
            circle.id = 'circle';
            circle.style.width = circleSize + 'px';
            circle.style.height = circleSize + 'px';
            circle.style.backgroundColor = circleColor;
            gameArea.appendChild(circle);

            score = 0;
            totalTime = 0;
            startTime = performance.now();
            gameEnded = false;

            circlePosX = Math.random() * (width - circleSize);
            circlePosY = Math.random() * (height - circleSize);
            directionX = (Math.random() < 0.5 ? -1 : 1);
            directionY = (Math.random() < 0.5 ? -1 : 1);
            lastTime = performance.now();

            circle.style.left = circlePosX + 'px';
            circle.style.top = circlePosY + 'px';

            gameArea.onmousemove = null;
            gameArea.onclick = null;

            if (aimingType === 'hold') {
                gameArea.onmousemove = trackMouse;
            } else {
                gameArea.onclick = trackClick;
                gameArea.onmousemove = trackMouseForClickMode;  // Pøidání této øádky
            }

            if (movementType === 'smooth') {
                moveCircleSmooth();
            } else {
                moveCircleJump();
            }

            timeInterval = setInterval(updateTime, 100);

            setTimeout(endGame, duration * 1000);
        }

        function moveCircleSmooth() {
            if (gameEnded) return;

            let currentTime = performance.now();
            let deltaTime = (currentTime - lastTime) / 1000;
            lastTime = currentTime;

            circlePosX += directionX * speed * deltaTime;
            circlePosY += directionY * speed * deltaTime;

            if (Math.random() < 0.02) directionX *= -1;
            if (Math.random() < 0.02) directionY *= -1;

            if (circlePosX <= 0 || circlePosX >= width - circleSize) directionX *= -1;
            if (circlePosY <= 0 || circlePosY >= height - circleSize) directionY *= -1;

            circle.style.left = circlePosX + 'px';
            circle.style.top = circlePosY + 'px';

            if (aimingType === 'hold' && isMouseOverCircle) {
                score += deltaTime;
            }
            totalTime += deltaTime;
            document.getElementById('currentScore').innerText = aimingType === 'hold' ? ((score / totalTime) * 100).toFixed(2) : score;

            requestAnimationFrame(moveCircleSmooth);
        }

        function moveCircleJump() {
            if (gameEnded) return;

            let currentTime = performance.now();
            let deltaTime = (currentTime - lastTime) / 1000;
            lastTime = currentTime;

            if (deltaTime >= 1 / speed) {
                circlePosX = Math.random() * (width - circleSize);
                circlePosY = Math.random() * (height - circleSize);
                circle.style.left = circlePosX + 'px';
                circle.style.top = circlePosY + 'px';
                lastTime = currentTime;
            }

            if (aimingType === 'hold' && isMouseOverCircle) {
                score += deltaTime;
            }
            totalTime += deltaTime;
            document.getElementById('currentScore').innerText = aimingType === 'hold' ? ((score / totalTime) * 100).toFixed(2) : score;

            requestAnimationFrame(moveCircleJump);
        }

        function moveCircleJump() {
            if (gameEnded) return;

            let currentTime = performance.now();
            let deltaTime = (currentTime - lastTime) / 1000;
            let interval = 10 / speed;  // Interval skoku v sekundách

            if (deltaTime >= interval) {
                circlePosX = Math.random() * (width - circleSize);
                circlePosY = Math.random() * (height - circleSize);
                circle.style.left = circlePosX + 'px';
                circle.style.top = circlePosY + 'px';
                lastTime = currentTime;  // Aktualizace lastTime pouze pøi skoku
            }

            if (aimingType === 'hold' && isMouseOverCircle) {
                score += deltaTime;
            }
            totalTime += deltaTime;
            document.getElementById('currentScore').innerText = aimingType === 'hold' ? ((score / totalTime) * 100).toFixed(2) : score;

            requestAnimationFrame(moveCircleJump);
        }

        function trackMouse(event) {
            let rect = gameArea.getBoundingClientRect();
            let mouseX = event.clientX - rect.left;
            let mouseY = event.clientY - rect.top;
            let circleX = parseFloat(circle.style.left);
            let circleY = parseFloat(circle.style.top);
            isMouseOverCircle = (mouseX >= circleX && mouseX <= circleX + parseFloat(circle.style.width) &&
                                 mouseY >= circleY && mouseY <= circleY + parseFloat(circle.style.height));
            if (isMouseOverCircle) {
                circle.classList.add('crosshair');
            } else {
                circle.classList.remove('crosshair');
            }
        }
        
        function trackClick(event) {
            let rect = gameArea.getBoundingClientRect();
            let mouseX = event.clientX - rect.left;
            let mouseY = event.clientY - rect.top;
            let circleX = parseFloat(circle.style.left);
            let circleY = parseFloat(circle.style.top);
            isMouseOverCircle = (mouseX >= circleX && mouseX <= circleX + parseFloat(circle.style.width) &&
                                 mouseY >= circleY && mouseY <= circleY + parseFloat(circle.style.height));
            if (isMouseOverCircle) {
                circle.classList.add('crosshair');
                score += 1;
            } else {
                circle.classList.remove('crosshair');
            }
            document.getElementById('currentScore').innerText = score;
        }

        function trackMouseForClickMode(event) {
            let rect = gameArea.getBoundingClientRect();
            let mouseX = event.clientX - rect.left;
            let mouseY = event.clientY - rect.top;
            let circleX = parseFloat(circle.style.left);
            let circleY = parseFloat(circle.style.top);
            isMouseOverCircle = (mouseX >= circleX && mouseX <= circleX + parseFloat(circle.style.width) &&
                                 mouseY >= circleY && mouseY <= circleY + parseFloat(circle.style.height));
            if (isMouseOverCircle) {
                circle.classList.add('crosshair');
            } else {
                circle.classList.remove('crosshair');
            }
        }

        function updateTime() {
            if (gameEnded) return;
            let currentTime = (performance.now() - startTime) / 1000;
            document.getElementById('currentTime').innerText = currentTime.toFixed(1) + ' s / ' + duration + ' s';
        }
        function endGame(endTime) {
            if (gameEnded) return;  // Kontrola, zda již hra nebyla ukonèena

            let elapsedTime = (endTime - startTime) / 1000;  // Vypoèítání uplynulého èasu v sekundách
            if (elapsedTime < duration) {
                console.error(`endGame called too early: ${elapsedTime} seconds elapsed, expected ${duration} seconds.`);
                return;
            }

            gameEnded = true;
            gameArea.onmousemove = null;
            gameArea.onclick = null;
            clearInterval(timeInterval);
            if (circle) {
                gameArea.removeChild(circle);
                circle = null;
            }

            let finalScore;
            if (aimingType === 'hold') {
                finalScore = ((score / totalTime) * 100).toFixed(2) + '%';
                document.getElementById('finalScore').innerText = finalScore;
            } else {
                finalScore = score;
                document.getElementById('finalScore').innerText = finalScore;
            }

            updateHistory(finalScore);
        }
        /*
        function endGameBACKUP() {
            console.log('End game')
            if (gameEnded) return;
            gameEnded = true;
            gameArea.onmousemove = null;
            gameArea.onclick = null;
            clearInterval(timeInterval);
            if (circle) {
                gameArea.removeChild(circle);
                circle = null;
            }

            let finalScore;
            if (aimingType === 'hold') {
                finalScore = ((score / totalTime) * 100).toFixed(2) + '%';
                document.getElementById('finalScore').innerText = finalScore;
            } else {
                finalScore = score;
                document.getElementById('finalScore').innerText = finalScore;
            }

            updateHistory(finalScore);
        }
        */

        function updateHistory(finalScore) {
            const historyList = document.getElementById('historyList');
            const newEntry = document.createElement('div');
            newEntry.innerText = `Game Type: ${movementType}, Aiming Type: ${aimingType}, Circle Size: ${circleSize}px, Speed: ${speed}px/s, Score: ${finalScore}`;
            historyList.insertBefore(newEntry, historyList.firstChild);
        }
        function clearHistory() {
            const historyList = document.getElementById('historyList');
            historyList.innerHTML = '';
        }
    </script>
</body>
</html> 
